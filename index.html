<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantumSafe RLWE Cryptosystem</title>
    <style>
        :root {
            --primary-dark: #0d1b2a;
            --primary: #1b263b;
            --secondary: #415a77;
            --accent: #778da9;
            --light: #e0e1dd;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #e63946;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(27, 38, 59, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--accent);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(13, 27, 42, 0.7);
            border-radius: 10px;
            border: 1px solid var(--secondary);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: var(--success);
            text-shadow: 0 2px 10px rgba(76, 201, 240, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--accent);
            margin-bottom: 20px;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            background: rgba(13, 27, 42, 0.7);
            border-radius: 10px;
            overflow: hidden;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            min-width: 120px;
        }
        
        .tab.active {
            background: rgba(76, 201, 240, 0.2);
            border-bottom: 3px solid var(--success);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .panel {
            background: rgba(21, 31, 46, 0.9);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--secondary);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }
        
        .panel h2 {
            color: var(--success);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
            font-size: 1.5rem;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--accent);
            font-size: 1rem;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            background: rgba(13, 27, 42, 0.8);
            color: var(--light);
            font-size: 1rem;
            border: 1px solid var(--secondary);
            transition: all 0.3s ease;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--success);
            box-shadow: 0 0 15px rgba(76, 201, 240, 0.2);
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
            line-height: 1.5;
        }
        
        button {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-encrypt {
            background: linear-gradient(135deg, #2a9d8f, #264653);
        }
        
        .btn-decrypt {
            background: linear-gradient(135deg, #e76f51, #f4a261);
        }
        
        .btn-generate {
            background: linear-gradient(135deg, #7209b7, #3a0ca3);
        }
        
        .btn-clear {
            background: linear-gradient(135deg, var(--warning), var(--danger);
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background: rgba(13, 27, 42, 0.8);
            min-height: 120px;
            border: 1px solid var(--secondary);
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .result-label {
            font-size: 1rem;
            color: var(--success);
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .status-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(13, 27, 42, 0.8);
            border-radius: 8px;
            border: 1px solid var(--secondary);
        }
        
        .status-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .status-working {
            animation: pulse 1.5s infinite;
            background: var(--success);
        }
        
        .status-error {
            background: var(--danger);
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        .key-display {
            margin-top: 15px;
            padding: 15px;
            background: rgba(13, 27, 42, 0.7);
            border-radius: 8px;
            border: 1px solid var(--secondary);
            word-break: break-all;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .key-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .key-actions button {
            flex: 1;
            margin-top: 0;
            padding: 10px;
            min-width: 120px;
        }
        
        .progress-container {
            margin: 20px 0;
            background: rgba(13, 27, 42, 0.8);
            border-radius: 8px;
            height: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--success));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .settings-panel {
            background: rgba(13, 27, 42, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid var(--secondary);
        }
        
        .settings-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .settings-row label {
            margin-bottom: 0;
            min-width: 150px;
        }
        
        .settings-row select, .settings-row input {
            flex: 1;
            margin-bottom: 0;
            min-width: 200px;
        }
        
        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .format-option {
            padding: 15px;
            background: rgba(27, 38, 59, 0.7);
            border-radius: 8px;
            border: 1px solid var(--secondary);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--accent);
            font-size: 0.9rem;
            border-top: 1px solid var(--secondary);
        }
        
        @media (max-width: 768px) {
            .tab {
                min-width: 100px;
                padding: 10px;
            }
            
            .settings-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .settings-row select, .settings-row input {
                width: 100%;
            }
            
            .key-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>QuantumSafe RLWE Cryptosystem</h1>
            <p class="subtitle">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—ã –Ω–∞ –∫–æ–ª—å—Ü–µ–≤—ã—Ö —Ä–µ—à–µ—Ç–∫–∞—Ö</p>
        </header>
        
        <div class="tab-container">
            <div class="tab active" onclick="switchTab('params')">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
            <div class="tab" onclick="switchTab('keys')">–ö–ª—é—á–∏</div>
            <div class="tab" onclick="switchTab('encrypt')">–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="tab" onclick="switchTab('decrypt')">–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="tab" onclick="switchTab('formats')">–§–æ—Ä–º–∞—Ç—ã</div>
        </div>
        
        <div class="tab-content active" id="params-tab">
            <div class="panel">
                <h2>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h2>
                
                <div class="settings-row">
                    <label for="securityLevel">–£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</label>
                    <select id="securityLevel">
                        <option value="128">128 –±–∏—Ç (n=512)</option>
                        <option value="192" selected>192 –±–∏—Ç (n=1024)</option>
                        <option value="256">256 –±–∏—Ç (n=2048)</option>
                    </select>
                </div>
                
                <div class="settings-row">
                    <label for="modulusType">–¢–∏–ø –º–æ–¥—É–ª—è:</label>
                    <select id="modulusType">
                        <option value="12289">q=12289 (NTT-–¥—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π)</option>
                        <option value="7681">q=7681 (–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)</option>
                    </select>
                </div>
                
                <div class="settings-row">
                    <label for="errorDistribution">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫:</label>
                    <select id="errorDistribution">
                        <option value="gaussian">–î–∏—Å–∫—Ä–µ—Ç–Ω–æ–µ –≥–∞—É—Å—Å–æ–≤–æ (œÉ=3.2)</option>
                        <option value="uniform">–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ (–±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ)</option>
                    </select>
                </div>
                
                <div class="settings-row">
                    <label for="encodingScheme">–°—Ö–µ–º–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <select id="encodingScheme">
                        <option value="coefficient">–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã</option>
                        <option value="ntt">NTT-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ</option>
                    </select>
                </div>
                
                <button class="btn-apply" onclick="saveParameters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</button>
            </div>
        </div>
        
        <div class="tab-content" id="keys-tab">
            <div class="panel">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏</h2>
                
                <div class="input-group">
                    <label for="keyComment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∫–ª—é—á–∞–º:</label>
                    <input type="text" id="keyComment" placeholder="–ú–æ–∏ RLWE –∫–ª—é—á–∏">
                </div>
                
                <button class="btn-generate" onclick="generateKeyPair()">üîë –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—É—é –ø–∞—Ä—É</button>
                
                <div class="progress-container">
                    <div class="progress-bar" id="keyGenProgress"></div>
                </div>
                
                <div class="result">
                    <div class="result-label">–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á:</div>
                    <div class="key-display" id="publicKeyDisplay">–ö–ª—é—á –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω</div>
                    <div class="key-actions">
                        <button onclick="copyPublicKey()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button onclick="downloadPublicKey()">üì• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="showPublicKeyInfo()">üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
                    </div>
                </div>
                
                <div class="result">
                    <div class="result-label">–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á:</div>
                    <div class="key-display" id="secretKeyDisplay">–ö–ª—é—á –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω</div>
                    <div class="key-actions">
                        <button onclick="copySecretKey()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button onclick="downloadSecretKey()">üì• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="showSecretKeyInfo()">üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="encrypt-tab">
            <div class="panel">
                <h2>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
                
                <div class="input-group">
                    <label for="recipientPublicKey">–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –ø–æ–ª—É—á–∞—Ç–µ–ª—è:</label>
                    <textarea id="recipientPublicKey" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON..."></textarea>
                </div>
                
                <div class="input-group">
                    <label for="messageToEncrypt">–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <textarea id="messageToEncrypt" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è...">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ RLWE –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π</textarea>
                </div>
                
                <div class="settings-row">
                    <label for="encryptionMode">–†–µ–∂–∏–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <select id="encryptionMode">
                        <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</option>
                        <option value="authenticated">–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
                        <option value="hybrid">–ì–∏–±—Ä–∏–¥–Ω—ã–π (RLWE + AES)</option>
                    </select>
                </div>
                
                <button class="btn-encrypt" onclick="encryptMessage()">üîí –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                
                <div class="progress-container">
                    <div class="progress-bar" id="encryptProgress"></div>
                </div>
                
                <div class="result">
                    <div class="result-label">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</div>
                    <div id="encryptedMessageResult"></div>
                    <div class="key-actions">
                        <button onclick="copyEncryptedMessage()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button onclick="downloadEncryptedMessage()">üì• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="analyzeCiphertext()">üìä –ê–Ω–∞–ª–∏–∑</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="decrypt-tab">
            <div class="panel">
                <h2>–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
                
                <div class="input-group">
                    <label for="encryptedMessage">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="encryptedMessage" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
                </div>
                
                <div class="input-group">
                    <label for="decryptionKey">–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <textarea id="decryptionKey" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á..."></textarea>
                </div>
                
                <div class="settings-row">
                    <label for="decryptionMode">–†–µ–∂–∏–º –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <select id="decryptionMode">
                        <option value="auto">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</option>
                        <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</option>
                        <option value="authenticated">–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
                    </select>
                </div>
                
                <button class="btn-decrypt" onclick="decryptMessage()">üîì –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                
                <div class="progress-container">
                    <div class="progress-bar" id="decryptProgress"></div>
                </div>
                
                <div class="result">
                    <div class="result-label">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</div>
                    <div id="decryptedMessageResult"></div>
                    <div class="key-actions">
                        <button onclick="copyDecryptedMessage()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button onclick="downloadDecryptedMessage()">üì• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="verifyDecryption()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="formats-tab">
            <div class="panel">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤</h2>
                
                <div class="format-options">
                    <div class="format-option">
                        <h3>–§–æ—Ä–º–∞—Ç—ã –∫–ª—é—á–µ–π</h3>
                        <div class="settings-row">
                            <label for="keyFormat">–§–æ—Ä–º–∞—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:</label>
                            <select id="keyFormat">
                                <option value="json">JSON (–ø–æ–ª–Ω—ã–π)</option>
                                <option value="json-compact">JSON (–∫–æ–º–ø–∞–∫—Ç–Ω—ã–π)</option>
                                <option value="base64">Base64</option>
                                <option value="base64url">Base64 URL Safe</option>
                                <option value="hex">Hex</option>
                                <option value="binary">–ë–∏–Ω–∞—Ä–Ω—ã–π</option>
                                <option value="pem">PEM-like</option>
                            </select>
                        </div>
                        
                        <div class="settings-row">
                            <label for="keyCompression">–°–∂–∞—Ç–∏–µ:</label>
                            <select id="keyCompression">
                                <option value="none">–ë–µ–∑ —Å–∂–∞—Ç–∏—è</option>
                                <option value="gzip">GZIP</option>
                                <option value="brotli">Brotli</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="format-option">
                        <h3>–§–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                        <div class="settings-row">
                            <label for="messageFormat">–§–æ—Ä–º–∞—Ç —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞:</label>
                            <select id="messageFormat">
                                <option value="json">JSON Structured</option>
                                <option value="json-compact">JSON Compact</option>
                                <option value="messagepack">MessagePack</option>
                                <option value="base64">Base64</option>
                                <option value="binary">Binary</option>
                            </select>
                        </div>
                        
                        <div class="settings-row">
                            <label for="messageEncoding">–ö–æ–¥–∏—Ä–æ–≤–∫–∞:</label>
                            <select id="messageEncoding">
                                <option value="utf8">UTF-8</option>
                                <option value="base64">Base64</option>
                                <option value="hex">Hex</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="format-option">
                        <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</h3>
                        <div class="settings-row">
                            <label for="lineBreaks">–ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫:</label>
                            <select id="lineBreaks">
                                <option value="64">–ß–µ—Ä–µ–∑ 64 —Å–∏–º–≤–æ–ª–∞</option>
                                <option value="76">–ß–µ—Ä–µ–∑ 76 —Å–∏–º–≤–æ–ª–æ–≤ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                                <option value="80">–ß–µ—Ä–µ–∑ 80 —Å–∏–º–≤–æ–ª–æ–≤</option>
                                <option value="none">–ë–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤</option>
                            </select>
                        </div>
                        
                        <div class="settings-row">
                            <label for="includeMetadata">–í–∫–ª—é—á–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:</label>
                            <input type="checkbox" id="includeMetadata" checked>
                        </div>
                    </div>
                </div>
                
                <button class="btn-apply" onclick="applyFormatSettings()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤</button>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="status-indicator" id="statusIndicator"></div>
            <span id="statusText">–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.</span>
        </div>
        
        <footer>
            <p>QuantumSafe RLWE Cryptosystem v2.0 | Post-Quantum Cryptographic System | 2024</p>
        </footer>
    </div>

    <script>
        // ============ –°–ò–°–¢–ï–ú–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ============
        const RLWE_CONFIG = {
            parameters: {
                '128': { n: 512, q: 12289, sigma: 3.2 },
                '192': { n: 1024, q: 12289, sigma: 3.2 },
                '256': { n: 2048, q: 12289, sigma: 3.2 }
            },
            formats: {
                key: 'json',
                message: 'json',
                encoding: 'utf8',
                compression: 'none',
                lineBreaks: '76',
                includeMetadata: true
            },
            security: {
                level: '192',
                modulusType: '12289',
                errorDistribution: 'gaussian',
                encodingScheme: 'coefficient'
            }
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let currentPublicKey = null;
        let currentSecretKey = null;
        let currentParams = null;
        let nttContext = null;

        // ============ –ú–ê–¢–ï–ú–ê–¢–ò–ß–ï–°–ö–û–ï –Ø–î–†–û ============

        class NTTContext {
            constructor(n, q) {
                this.n = n;
                this.q = q;
                this.roots = this.precomputeRoots();
                this.invRoots = this.precomputeInverseRoots();
                this.invN = this.modInverse(n, q);
            }

            precomputeRoots() {
                const root = this.findPrimitiveRoot();
                const roots = new Array(this.n);
                roots[0] = 1;
                
                for (let i = 1; i < this.n; i++) {
                    roots[i] = this.modPow(root, i, this.q);
                }
                
                return roots;
            }

            precomputeInverseRoots() {
                const invRoots = new Array(this.n);
                for (let i = 0; i < this.n; i++) {
                    invRoots[i] = this.modInverse(this.roots[i], this.q);
                }
                return invRoots;
            }

            findPrimitiveRoot() {
                // –ü–æ–∏—Å–∫ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–≥–æ –∫–æ—Ä–Ω—è 2n-–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –∏–∑ –µ–¥–∏–Ω–∏—Ü—ã
                const factors = this.primeFactors(this.q - 1);
                
                for (let g = 2; g < this.q; g++) {
                    if (this.modPow(g, (this.q - 1) / 2, this.q) !== 1) {
                        let valid = true;
                        for (const factor of factors) {
                            if (factor !== 2 && this.modPow(g, (this.q - 1) / factor, this.q) === 1) {
                                valid = false;
                                break;
                            }
                        }
                        if (valid) return g;
                    }
                }
                throw new Error("Primitive root not found");
            }

            primeFactors(n) {
                const factors = new Set();
                while (n % 2 === 0) {
                    factors.add(2);
                    n = n / 2;
                }
                
                for (let i = 3; i <= Math.sqrt(n); i += 2) {
                    while (n % i === 0) {
                        factors.add(i);
                        n = n / i;
                    }
                }
                
                if (n > 2) factors.add(n);
                return Array.from(factors);
            }

            modPow(base, exponent, mod) {
                let result = 1n;
                base = BigInt(base) % BigInt(mod);
                let exp = BigInt(exponent);
                
                while (exp > 0) {
                    if (exp % 2n === 1n) {
                        result = (result * base) % BigInt(mod);
                    }
                    base = (base * base) % BigInt(mod);
                    exp = exp / 2n;
                }
                
                return Number(result);
            }

            modInverse(a, m) {
                let [old_r, r] = [BigInt(a), BigInt(m)];
                let [old_s, s] = [1n, 0n];
                
                while (r !== 0n) {
                    const quotient = old_r / r;
                    [old_r, r] = [r, old_r - quotient * r];
                    [old_s, s] = [s, old_s - quotient * s];
                }
                
                return Number(old_s < 0n ? old_s + BigInt(m) : old_s) % m;
            }

            forwardNTT(poly) {
                return this.transform(poly, this.roots);
            }

            inverseNTT(poly) {
                const result = this.transform(poly, this.invRoots);
                for (let i = 0; i < this.n; i++) {
                    result[i] = this.modMul(result[i], this.invN, this.q);
                }
                return result;
            }

            transform(poly, roots) {
                const result = [...poly];
                let len = this.n / 2;
                
                for (let i = 1; i < this.n; i <<= 1) {
                    for (let j = 0; j < this.n; j += 2 * i) {
                        for (let k = 0; k < i; k++) {
                            const u = result[j + k];
                            const v = this.modMul(result[j + k + i], roots[this.n / (2 * i) * k], this.q);
                            
                            result[j + k] = this.modAdd(u, v, this.q);
                            result[j + k + i] = this.modSub(u, v, this.q);
                        }
                    }
                }
                
                return result;
            }

            modAdd(a, b, mod) {
                return (a + b) % mod;
            }

            modSub(a, b, mod) {
                return (a - b + mod) % mod;
            }

            modMul(a, b, mod) {
                return Number((BigInt(a) * BigInt(b)) % BigInt(mod));
            }
        }

        class GaussianSampler {
            constructor(sigma, tau = 6) {
                this.sigma = sigma;
                this.tau = tau;
                this.precomputed = this.precomputeDistribution();
            }

            precomputeDistribution() {
                const values = [];
                const probabilities = [];
                let total = 0;
                
                const min = -Math.floor(this.tau * this.sigma);
                const max = Math.floor(this.tau * this.sigma);
                
                for (let x = min; x <= max; x++) {
                    const prob = Math.exp(-x * x / (2 * this.sigma * this.sigma));
                    values.push(x);
                    probabilities.push(prob);
                    total += prob;
                }
                
                // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ CDF
                const cdf = [];
                let cumulative = 0;
                
                for (let i = 0; i < values.length; i++) {
                    cumulative += probabilities[i] / total;
                    cdf.push({ value: values[i], cumulative });
                }
                
                return cdf;
            }

            sample() {
                const u = crypto.getRandomValues(new Uint32Array(1))[0] / 4294967296;
                
                for (const item of this.precomputed) {
                    if (u <= item.cumulative) {
                        return item.value;
                    }
                }
                
                return this.precomputed[this.precomputed.length - 1].value;
            }

            sampleArray(n) {
                const result = new Array(n);
                for (let i = 0; i < n; i++) {
                    result[i] = this.sample();
                }
                return result;
            }
        }

        // ============ –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò RLWE ============

        function initializeRLWE() {
            const securityLevel = RLWE_CONFIG.security.level;
            currentParams = RLWE_CONFIG.parameters[securityLevel];
            nttContext = new NTTContext(currentParams.n, currentParams.q);
            
            updateStatus(`–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: n=${currentParams.n}, q=${currentParams.q}`, 'ready');
        }

        function generateKeyPair() {
            if (!currentParams) {
                updateStatus('–°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã', 'error');
                return;
            }

            updateStatus('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π...', 'working');
            
            try {
                const { n, q, sigma } = currentParams;
                const sampler = new GaussianSampler(sigma);

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
                currentSecretKey = sampler.sampleArray(n);

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ a
                const a = new Array(n);
                const randomValues = new Uint32Array(n);
                window.crypto.getRandomValues(randomValues);
                
                for (let i = 0; i < n; i++) {
                    a[i] = randomValues[i] % q;
                }

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏ e
                const e = sampler.sampleArray(n);

                // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ b = a*s + e –≤ NTT domain
                const a_ntt = nttContext.forwardNTT(a);
                const s_ntt = nttContext.forwardNTT(currentSecretKey);
                const e_ntt = nttContext.forwardNTT(e);

                const b_ntt = new Array(n);
                for (let i = 0; i < n; i++) {
                    b_ntt[i] = nttContext.modAdd(
                        nttContext.modMul(a_ntt[i], s_ntt[i], q),
                        e_ntt[i],
                        q
                    );
                }

                currentPublicKey = {
                    a: a_ntt,
                    b: b_ntt,
                    params: currentParams,
                    timestamp: new Date().toISOString(),
                    comment: document.getElementById('keyComment').value || 'RLWE Key'
                };

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª—é—á–µ–π
                displayKeys();
                updateStatus('–ö–ª—é—á–µ–≤–∞—è –ø–∞—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞', 'ready');

            } catch (error) {
                updateStatus('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π: ' + error.message, 'error');
            }
        }

        function encryptMessage() {
            if (!currentPublicKey) {
                updateStatus('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏', 'error');
                return;
            }

            const message = document.getElementById('messageToEncrypt').value;
            if (!message) {
                updateStatus('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', 'error');
                return;
            }

            updateStatus('–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è...', 'working');

            try {
                const { n, q, sigma } = currentPublicKey.params;
                const sampler = new GaussianSampler(sigma);

                // –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                const messagePoly = encodeMessage(message, n, q);
                const message_ntt = nttContext.forwardNTT(messagePoly);

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–ª–∏–Ω–æ–º–∞ r
                const r = sampler.sampleArray(n);
                const r_ntt = nttContext.forwardNTT(r);

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—à–∏–±–æ–∫ e1, e2
                const e1 = sampler.sampleArray(n);
                const e2 = sampler.sampleArray(n);
                const e1_ntt = nttContext.forwardNTT(e1);
                const e2_ntt = nttContext.forwardNTT(e2);

                // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤ NTT domain
                const u_ntt = new Array(n);
                const v_ntt = new Array(n);

                for (let i = 0; i < n; i++) {
                    u_ntt[i] = nttContext.modAdd(
                        nttContext.modMul(currentPublicKey.a[i], r_ntt[i], q),
                        e1_ntt[i],
                        q
                    );

                    v_ntt[i] = nttContext.modAdd(
                        nttContext.modAdd(
                            nttContext.modMul(currentPublicKey.b[i], r_ntt[i], q),
                            e2_ntt[i],
                            q
                        ),
                        message_ntt[i],
                        q
                    );
                }

                // –°–æ–∑–¥–∞–Ω–∏–µ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞
                const ciphertext = {
                    u: u_ntt,
                    v: v_ntt,
                    params: currentPublicKey.params,
                    timestamp: new Date().toISOString(),
                    mode: document.getElementById('encryptionMode').value
                };

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                displayCiphertext(ciphertext);
                updateStatus('–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ', 'ready');

            } catch (error) {
                updateStatus('–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'error');
            }
        }

        function decryptMessage() {
            const ciphertextText = document.getElementById('encryptedMessage').value;
            const secretKeyText = document.getElementById('decryptionKey').value;

            if (!ciphertextText || !secretKeyText) {
                updateStatus('–í–≤–µ–¥–∏—Ç–µ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á', 'error');
                return;
            }

            updateStatus('–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è...', 'working');

            try {
                // –ü–∞—Ä—Å–∏–Ω–≥ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞ –∏ –∫–ª—é—á–∞
                const ciphertext = JSON.parse(ciphertextText);
                const secretKey = JSON.parse(secretKeyText);

                const { n, q } = ciphertext.params;

                // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤ NTT domain
                const decrypted_ntt = new Array(n);
                for (let i = 0; i < n; i++) {
                    const su = nttContext.modMul(ciphertext.u[i], secretKey.s[i], q);
                    decrypted_ntt[i] = nttContext.modSub(ciphertext.v[i], su, q);
                }

                // –û–±—Ä–∞—Ç–Ω–æ–µ NTT –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
                const decrypted = nttContext.inverseNTT(decrypted_ntt);

                // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                const message = decodeMessage(decrypted, n, q);

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                document.getElementById('decryptedMessageResult').textContent = message;
                updateStatus('–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ', 'ready');

            } catch (error) {
                updateStatus('–û—à–∏–±–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // ============ –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ============

        function encodeMessage(message, n, q) {
            const encoder = new TextEncoder();
            const data = encoder.encode(message);
            const scale = Math.floor(q / 256);
            
            const result = new Array(n).fill(0);
            
            for (let i = 0; i < Math.min(data.length, n); i++) {
                result[i] = data[i] * scale;
            }
            
            return result;
        }

        function decodeMessage(coefficients, n, q) {
            const scale = Math.floor(q / 256);
            const data = [];
            
            for (let i = 0; i < n; i++) {
                const value = Math.round(coefficients[i] / scale) % 256;
                if (value === 0) break;
                data.push(value);
            }
            
            const decoder = new TextDecoder();
            return decoder.decode(new Uint8Array(data));
        }

        function displayKeys() {
            const keyFormat = RLWE_CONFIG.formats.key;
            
            switch (keyFormat) {
                case 'json':
                    document.getElementById('publicKeyDisplay').textContent = 
                        JSON.stringify(currentPublicKey, null, 2);
                    document.getElementById('secretKeyDisplay').textContent = 
                        JSON.stringify({ s: currentSecretKey, params: currentParams }, null, 2);
                    break;
                    
                case 'base64':
                    document.getElementById('publicKeyDisplay').textContent = 
                        btoa(JSON.stringify(currentPublicKey));
                    document.getElementById('secretKeyDisplay').textContent = 
                        btoa(JSON.stringify({ s: currentSecretKey, params: currentParams }));
                    break;
                    
                default:
                    document.getElementById('publicKeyDisplay').textContent = 
                        JSON.stringify(currentPublicKey);
                    document.getElementById('secretKeyDisplay').textContent = 
                        JSON.stringify({ s: currentSecretKey, params: currentParams });
            }
        }

        function displayCiphertext(ciphertext) {
            const messageFormat = RLWE_CONFIG.formats.message;
            
            switch (messageFormat) {
                case 'json':
                    document.getElementById('encryptedMessageResult').textContent = 
                        JSON.stringify(ciphertext, null, 2);
                    break;
                    
                case 'base64':
                    document.getElementById('encryptedMessageResult').textContent = 
                        btoa(JSON.stringify(ciphertext));
                    break;
                    
                default:
                    document.getElementById('encryptedMessageResult').textContent = 
                        JSON.stringify(ciphertext);
            }
        }

        function updateStatus(message, type = 'ready') {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            indicator.className = 'status-indicator';
            if (type === 'working') indicator.classList.add('status-working');
            if (type === 'error') indicator.classList.add('status-error');
            
            statusText.textContent = message;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.tab:nth-child(${['params','keys','encrypt','decrypt','formats'].indexOf(tabName) + 1})`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        function saveParameters() {
            RLWE_CONFIG.security.level = document.getElementById('securityLevel').value;
            RLWE_CONFIG.security.modulusType = document.getElementById('modulusType').value;
            RLWE_CONFIG.security.errorDistribution = document.getElementById('errorDistribution').value;
            RLWE_CONFIG.security.encodingScheme = document.getElementById('encodingScheme').value;
            
            initializeRLWE();
            updateStatus('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã', 'ready');
        }

        function applyFormatSettings() {
            RLWE_CONFIG.formats.key = document.getElementById('keyFormat').value;
            RLWE_CONFIG.formats.message = document.getElementById('messageFormat').value;
            RLWE_CONFIG.formats.encoding = document.getElementById('messageEncoding').value;
            RLWE_CONFIG.formats.compression = document.getElementById('keyCompression').value;
            RLWE_CONFIG.formats.lineBreaks = document.getElementById('lineBreaks').value;
            RLWE_CONFIG.formats.includeMetadata = document.getElementById('includeMetadata').checked;
            
            updateStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã', 'ready');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
        document.addEventListener('DOMContentLoaded', function() {
            initializeRLWE();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantumSafe RLWE Cryptosystem - –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        :root {
            --primary-dark: #0d1b2a;
            --primary: #1b263b;
            --secondary: #415a77;
            --accent: #778da9;
            --light: #e0e1dd;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #e63946;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(27, 38, 59, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--accent);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(13, 27, 42, 0.7);
            border-radius: 10px;
            border: 1px solid var(--secondary);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: var(--success);
            text-shadow: 0 2px 10px rgba(76, 201, 240, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--accent);
            margin-bottom: 20px;
        }
        
        .warning {
            background: linear-gradient(135deg, #f72585, #e63946);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            background: rgba(13, 27, 42, 0.7);
            border-radius: 10px;
            overflow: hidden;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            min-width: 120px;
        }
        
        .tab.active {
            background: rgba(76, 201, 240, 0.2);
            border-bottom: 3px solid var(--success);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .panel {
            background: rgba(21, 31, 46, 0.9);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--secondary);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }
        
        .panel h2 {
            color: var(--success);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
            font-size: 1.5rem;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--accent);
            font-size: 1rem;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            background: rgba(13, 27, 42, 0.8);
            color: var(--light);
            font-size: 1rem;
            border: 1px solid var(--secondary);
            transition: all 0.3s ease;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--success);
            box-shadow: 0 0 15px rgba(76, 201, 240, 0.2);
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
            line-height: 1.5;
        }
        
        button {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-encrypt {
            background: linear-gradient(135deg, #2a9d8f, #264653);
        }
        
        .btn-decrypt {
            background: linear-gradient(135deg, #e76f51, #f4a261);
        }
        
        .btn-generate {
            background: linear-gradient(135deg, #7209b7, #3a0ca3);
        }
        
        .btn-clear {
            background: linear-gradient(135deg, var(--warning), var(--danger));
        }
        
        .btn-apply {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background: rgba(13, 27, 42, 0.8);
            min-height: 120px;
            border: 1px solid var(--secondary);
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .result-label {
            font-size: 1rem;
            color: var(--success);
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .status-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(13, 27, 42, 0.8);
            border-radius: 8px;
            border: 1px solid var(--secondary);
        }
        
        .status-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .status-working {
            animation: pulse 1.5s infinite;
            background: var(--success);
        }
        
        .status-error {
            background: var(--danger);
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        .key-display {
            margin-top: 15px;
            padding: 15px;
            background: rgba(13, 27, 42, 0.7);
            border-radius: 8px;
            border: 1px solid var(--secondary);
            word-break: break-all;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .key-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .key-actions button {
            flex: 1;
            margin-top: 0;
            padding: 10px;
            min-width: 120px;
        }
        
        .progress-container {
            margin: 20px 0;
            background: rgba(13, 27, 42, 0.8);
            border-radius: 8px;
            height: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--success));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .settings-panel {
            background: rgba(13, 27, 42, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid var(--secondary);
        }
        
        .settings-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .settings-row label {
            margin-bottom: 0;
            min-width: 150px;
        }
        
        .settings-row select, .settings-row input {
            flex: 1;
            margin-bottom: 0;
            min-width: 200px;
        }
        
        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .format-option {
            padding: 15px;
            background: rgba(27, 38, 59, 0.7);
            border-radius: 8px;
            border: 1px solid var(--secondary);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--accent);
            font-size: 0.9rem;
            border-top: 1px solid var(--secondary);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .modal-content {
            background: var(--primary);
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            border: 2px solid var(--accent);
        }
        
        .close {
            color: var(--accent);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: var(--light);
        }
        
        @media (max-width: 768px) {
            .tab {
                min-width: 100px;
                padding: 10px;
            }
            
            .settings-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .settings-row select, .settings-row input {
                width: 100%;
            }
            
            .key-actions {
                flex-direction: column;
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>QuantumSafe RLWE Cryptosystem</h1>
            <p class="subtitle">–ü–æ–ª–Ω–∞—è —Ä–∞–±–æ—á–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º—ã –Ω–∞ –∫–æ–ª—å—Ü–µ–≤—ã—Ö —Ä–µ—à–µ—Ç–∫–∞—Ö</p>
            <div class="warning">
                ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –∑–∞—â–∏—Ç—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö!
            </div>
        </header>
        
        <div class="tab-container">
            <div class="tab active" onclick="switchTab('params')">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
            <div class="tab" onclick="switchTab('keys')">–ö–ª—é—á–∏</div>
            <div class="tab" onclick="switchTab('encrypt')">–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="tab" onclick="switchTab('decrypt')">–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="tab" onclick="switchTab('formats')">–§–æ—Ä–º–∞—Ç—ã</div>
        </div>
        
        <div class="tab-content active" id="params-tab">
            <div class="panel">
                <h2>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h2>
                
                <div class="settings-row">
                    <label for="securityLevel">–£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</label>
                    <select id="securityLevel">
                        <option value="128">128 –±–∏—Ç (n=512)</option>
                        <option value="192" selected>192 –±–∏—Ç (n=1024)</option>
                        <option value="256">256 –±–∏—Ç (n=2048)</option>
                    </select>
                </div>
                
                <div class="settings-row">
                    <label for="modulusType">–¢–∏–ø –º–æ–¥—É–ª—è:</label>
                    <select id="modulusType">
                        <option value="12289">q=12289 (NTT-–¥—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π)</option>
                        <option value="7681">q=7681 (–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)</option>
                    </select>
                </div>
                
                <div class="settings-row">
                    <label for="errorDistribution">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫:</label>
                    <select id="errorDistribution">
                        <option value="gaussian">–î–∏—Å–∫—Ä–µ—Ç–Ω–æ–µ –≥–∞—É—Å—Å–æ–≤–æ (œÉ=3.2)</option>
                        <option value="uniform">–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ (–±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ)</option>
                    </select>
                </div>
                
                <div class="settings-row">
                    <label for="encodingScheme">–°—Ö–µ–º–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <select id="encodingScheme">
                        <option value="coefficient">–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã</option>
                        <option value="ntt">NTT-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ</option>
                    </select>
                </div>
                
                <button class="btn-apply" onclick="saveParameters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</button>
            </div>
        </div>
        
        <div class="tab-content" id="keys-tab">
            <div class="panel">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏</h2>
                
                <div class="input-group">
                    <label for="keyComment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∫–ª—é—á–∞–º:</label>
                    <input type="text" id="keyComment" placeholder="–ú–æ–∏ RLWE –∫–ª—é—á–∏">
                </div>
                
                <button class="btn-generate" onclick="generateKeyPair()">üîë –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—É—é –ø–∞—Ä—É</button>
                
                <div class="progress-container">
                    <div class="progress-bar" id="keyGenProgress"></div>
                </div>
                
                <div class="result">
                    <div class="result-label">–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á:</div>
                    <div class="key-display" id="publicKeyDisplay">–ö–ª—é—á –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω</div>
                    <div class="key-actions">
                        <button onclick="copyPublicKey()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button onclick="downloadPublicKey()">üì• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="showPublicKeyInfo()">üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
                    </div>
                </div>
                
                <div class="result">
                    <div class="result-label">–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á:</div>
                    <div class="key-display" id="secretKeyDisplay">–ö–ª—é—á –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω</div>
                    <div class="key-actions">
                        <button onclick="copySecretKey()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button onclick="downloadSecretKey()">üì• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="showSecretKeyInfo()">üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="encrypt-tab">
            <div class="panel">
                <h2>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
                
                <div class="input-group">
                    <label for="recipientPublicKey">–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –ø–æ–ª—É—á–∞—Ç–µ–ª—è:</label>
                    <textarea id="recipientPublicKey" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á..."></textarea>
                </div>
                
                <div class="input-group">
                    <label for="messageToEncrypt">–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <textarea id="messageToEncrypt" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è...">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ RLWE –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π</textarea>
                </div>
                
                <div class="settings-row">
                    <label for="encryptionMode">–†–µ–∂–∏–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <select id="encryptionMode">
                        <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</option>
                        <option value="authenticated">–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
                    </select>
                </div>
                
                <button class="btn-encrypt" onclick="encryptMessage()">üîí –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                
                <div class="progress-container">
                    <div class="progress-bar" id="encryptProgress"></div>
                </div>
                
                <div class="result">
                    <div class="result-label">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</div>
                    <div id="encryptedMessageResult"></div>
                    <div class="key-actions">
                        <button onclick="copyEncryptedMessage()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button onclick="downloadEncryptedMessage()">üì• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="analyzeCiphertext()">üìä –ê–Ω–∞–ª–∏–∑</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="decrypt-tab">
            <div class="panel">
                <h2>–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
                
                <div class="input-group">
                    <label for="encryptedMessage">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="encryptedMessage" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
                </div>
                
                <div class="input-group">
                    <label for="decryptionKey">–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <textarea id="decryptionKey" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á..."></textarea>
                </div>
                
                <button class="btn-decrypt" onclick="decryptMessage()">üîì –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                
                <div class="progress-container">
                    <div class="progress-bar" id="decryptProgress"></div>
                </div>
                
                <div class="result">
                    <div class="result-label">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</div>
                    <div id="decryptedMessageResult"></div>
                    <div class="key-actions">
                        <button onclick="copyDecryptedMessage()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button onclick="downloadDecryptedMessage()">üì• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="verifyDecryption()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="formats-tab">
            <div class="panel">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤</h2>
                
                <div class="format-options">
                    <div class="format-option">
                        <h3>–§–æ—Ä–º–∞—Ç—ã –∫–ª—é—á–µ–π</h3>
                        <div class="settings-row">
                            <label for="keyFormat">–§–æ—Ä–º–∞—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:</label>
                            <select id="keyFormat">
                                <option value="json">JSON (–ø–æ–ª–Ω—ã–π)</option>
                                <option value="json-compact">JSON (–∫–æ–º–ø–∞–∫—Ç–Ω—ã–π)</option>
                                <option value="base64">Base64</option>
                                <option value="hex">Hex</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="format-option">
                        <h3>–§–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                        <div class="settings-row">
                            <label for="messageFormat">–§–æ—Ä–º–∞—Ç —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞:</label>
                            <select id="messageFormat">
                                <option value="json">JSON Structured</option>
                                <option value="json-compact">JSON Compact</option>
                                <option value="base64">Base64</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="format-option">
                        <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</h3>
                        <div class="settings-row">
                            <label for="lineBreaks">–ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫:</label>
                            <select id="lineBreaks">
                                <option value="64">–ß–µ—Ä–µ–∑ 64 —Å–∏–º–≤–æ–ª–∞</option>
                                <option value="76">–ß–µ—Ä–µ–∑ 76 —Å–∏–º–≤–æ–ª–æ–≤ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                                <option value="none">–ë–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤</option>
                            </select>
                        </div>
                        
                        <div class="settings-row">
                            <label for="includeMetadata">–í–∫–ª—é—á–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:</label>
                            <input type="checkbox" id="includeMetadata" checked>
                        </div>
                    </div>
                </div>
                
                <button class="btn-apply" onclick="applyFormatSettings()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤</button>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="status-indicator" id="statusIndicator"></div>
            <span id="statusText">–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.</span>
        </div>
        
        <footer>
            <p>QuantumSafe RLWE Cryptosystem v2.1 | Post-Quantum Cryptographic System | 2024</p>
        </footer>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // ============ –°–ò–°–¢–ï–ú–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ============
        const RLWE_CONFIG = {
            parameters: {
                '128': { n: 512, q: 12289, sigma: 3.2 },
                '192': { n: 1024, q: 12289, sigma: 3.2 },
                '256': { n: 2048, q: 12289, sigma: 3.2 }
            },
            formats: {
                key: 'json',
                message: 'json',
                lineBreaks: '76',
                includeMetadata: true
            },
            security: {
                level: '192',
                modulusType: '12289',
                errorDistribution: 'gaussian',
                encodingScheme: 'coefficient'
            }
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let currentPublicKey = null;
        let currentSecretKey = null;
        let currentParams = null;
        let currentCiphertext = null;
        let currentDecryptedMessage = null;

        // ============ –ú–ê–¢–ï–ú–ê–¢–ò–ß–ï–°–ö–û–ï –Ø–î–†–û ============

        class Polynomial {
            constructor(coefficients, mod) {
                this.coefficients = coefficients;
                this.mod = mod;
                this.length = coefficients.length;
            }
            
            add(other) {
                const result = new Array(this.length);
                for (let i = 0; i < this.length; i++) {
                    result[i] = (this.coefficients[i] + other.coefficients[i]) % this.mod;
                }
                return new Polynomial(result, this.mod);
            }
            
            subtract(other) {
                const result = new Array(this.length);
                for (let i = 0; i < this.length; i++) {
                    result[i] = (this.coefficients[i] - other.coefficients[i] + this.mod) % this.mod;
                }
                return new Polynomial(result, this.mod);
            }
            
            multiply(other) {
                const result = new Array(this.length).fill(0);
                for (let i = 0; i < this.length; i++) {
                    for (let j = 0; j < this.length; j++) {
                        const k = (i + j) % this.length;
                        result[k] = (result[k] + this.coefficients[i] * other.coefficients[j]) % this.mod;
                    }
                }
                return new Polynomial(result, this.mod);
            }
            
            multiplyScalar(scalar) {
                const result = new Array(this.length);
                for (let i = 0; i < this.length; i++) {
                    result[i] = (this.coefficients[i] * scalar) % this.mod;
                }
                return new Polynomial(result, this.mod);
            }
            
            toArray() {
                return this.coefficients;
            }
        }

        class NTT {
            constructor(n, q) {
                this.n = n;
                this.q = q;
                this.omega = this.findPrimitiveRoot();
                this.invOmega = this.modInverse(this.omega, q);
                this.invN = this.modInverse(n, q);
            }
            
            findPrimitiveRoot() {
                // –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ—Ä–Ω–∏
                if (this.q === 12289) return 3;
                if (this.q === 7681) return 17;
                
                // –û–±—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–≥–æ –∫–æ—Ä–Ω—è
                const factors = this.getPrimeFactors(this.q - 1);
                
                for (let g = 2; g < this.q; g++) {
                    let valid = true;
                    for (const factor of factors) {
                        if (this.modPow(g, (this.q - 1) / factor, this.q) === 1) {
                            valid = false;
                            break;
                        }
                    }
                    if (valid) return g;
                }
                throw new Error("Primitive root not found");
            }
            
            getPrimeFactors(n) {
                const factors = new Set();
                while (n % 2 === 0) {
                    factors.add(2);
                    n = n / 2;
                }
                
                for (let i = 3; i <= Math.sqrt(n); i += 2) {
                    while (n % i === 0) {
                        factors.add(i);
                        n = n / i;
                    }
                }
                
                if (n > 2) factors.add(n);
                return Array.from(factors);
            }
            
            forward(poly) {
                return this.transform(poly, this.omega);
            }
            
            inverse(poly) {
                const result = this.transform(poly, this.invOmega);
                for (let i = 0; i < this.n; i++) {
                    result[i] = (result[i] * this.invN) % this.q;
                }
                return result;
            }
            
            transform(poly, root) {
                const result = [...poly];
                let len = this.n;
                
                for (let i = 1; i < len; i <<= 1) {
                    const wn = this.modPow(root, len / (2 * i), this.q);
                    
                    for (let j = 0; j < len; j += 2 * i) {
                        let w = 1;
                        
                        for (let k = 0; k < i; k++) {
                            const u = result[j + k];
                            const v = (result[j + k + i] * w) % this.q;
                            
                            result[j + k] = (u + v) % this.q;
                            result[j + k + i] = (u - v + this.q) % this.q;
                            
                            w = (w * wn) % this.q;
                        }
                    }
                }
                
                return result;
            }
            
            modPow(base, exponent, mod) {
                if (mod === 1) return 0;
                let result = 1;
                base = base % mod;
                
                while (exponent > 0) {
                    if (exponent % 2 === 1) {
                        result = (result * base) % mod;
                    }
                    exponent = Math.floor(exponent / 2);
                    base = (base * base) % mod;
                }
                
                return result;
            }
            
            modInverse(a, m) {
                let [t, newT] = [0, 1];
                let [r, newR] = [m, a];
                
                while (newR !== 0) {
                    const quotient = Math.floor(r / newR);
                    [t, newT] = [newT, t - quotient * newT];
                    [r, newR] = [newR, r - quotient * newR];
                }
                
                if (r > 1) throw new Error("a is not invertible");
                if (t < 0) t += m;
                return t;
            }
        }

        class GaussianSampler {
            constructor(sigma, bounds = 6) {
                this.sigma = sigma;
                this.bounds = bounds;
                this.min = -Math.floor(bounds * sigma);
                this.max = Math.floor(bounds * sigma);
                this.precomputed = this.precomputeDistribution();
            }
            
            precomputeDistribution() {
                const values = [];
                const probabilities = [];
                let total = 0;
                
                for (let x = this.min; x <= this.max; x++) {
                    const prob = Math.exp(-x * x / (2 * this.sigma * this.sigma));
                    values.push(x);
                    probabilities.push(prob);
                    total += prob;
                }
                
                // –°–æ–∑–¥–∞–µ–º CDF –¥–ª—è –≤—ã–±–æ—Ä–∫–∏
                const cdf = [];
                let cumulative = 0;
                
                for (let i = 0; i < values.length; i++) {
                    cumulative += probabilities[i] / total;
                    cdf.push({ value: values[i], cumulative });
                }
                
                return cdf;
            }
            
            sample() {
                const u = crypto.getRandomValues(new Uint32Array(1))[0] / 4294967296;
                
                for (const item of this.precomputed) {
                    if (u <= item.cumulative) {
                        return item.value;
                    }
                }
                
                return this.precomputed[this.precomputed.length - 1].value;
            }
            
            sampleArray(n) {
                const result = new Array(n);
                for (let i = 0; i < n; i++) {
                    result[i] = this.sample();
                }
                return result;
            }
        }

        // ============ –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò RLWE ============

        function initializeRLWE() {
            const securityLevel = RLWE_CONFIG.security.level;
            currentParams = RLWE_CONFIG.parameters[securityLevel];
            
            updateStatus(`–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: n=${currentParams.n}, q=${currentParams.q}`, 'ready');
        }

        function generateKeyPair() {
            if (!currentParams) {
                updateStatus('–°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã', 'error');
                return;
            }

            updateStatus('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π...', 'working');
            simulateProgress('keyGenProgress', 2000);
            
            setTimeout(() => {
                try {
                    const { n, q, sigma } = currentParams;
                    const sampler = new GaussianSampler(sigma);

                    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
                    currentSecretKey = sampler.sampleArray(n);

                    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏
                    const error = sampler.sampleArray(n);

                    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–ª–∏–Ω–æ–º–∞ a
                    const a = new Array(n);
                    const randomValues = new Uint32Array(n);
                    window.crypto.getRandomValues(randomValues);
                    
                    for (let i = 0; i < n; i++) {
                        a[i] = randomValues[i] % q;
                    }

                    // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ b = a*s + e
                    const b = new Array(n).fill(0);
                    for (let i = 0; i < n; i++) {
                        for (let j = 0; j < n; j++) {
                            const k = (i + j) % n;
                            b[k] = (b[k] + a[i] * currentSecretKey[j]) % q;
                        }
                        b[i] = (b[i] + error[i]) % q;
                    }

                    currentPublicKey = {
                        a: a,
                        b: b,
                        params: currentParams,
                        timestamp: new Date().toISOString(),
                        comment: document.getElementById('keyComment').value || 'RLWE Key'
                    };

                    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª—é—á–µ–π
                    displayKeys();
                    updateStatus('–ö–ª—é—á–µ–≤–∞—è –ø–∞—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞', 'ready');

                } catch (error) {
                    updateStatus('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π: ' + error.message, 'error');
                }
            }, 100);
        }

        function encryptMessage() {
            if (!currentPublicKey) {
                updateStatus('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏', 'error');
                return;
            }

            const message = document.getElementById('messageToEncrypt').value;
            if (!message) {
                updateStatus('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', 'error');
                return;
            }

            updateStatus('–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è...', 'working');
            simulateProgress('encryptProgress', 1500);

            setTimeout(() => {
                try {
                    const { n, q, sigma } = currentPublicKey.params;
                    const sampler = new GaussianSampler(sigma);

                    // –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    const messagePoly = encodeMessage(message, n, q);

                    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–ª–∏–Ω–æ–º–æ–≤
                    const r = sampler.sampleArray(n);
                    const e1 = sampler.sampleArray(n);
                    const e2 = sampler.sampleArray(n);

                    // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ: u = a*r + e1, v = b*r + e2 + message
                    const u = new Array(n).fill(0);
                    const v = new Array(n).fill(0);

                    for (let i = 0; i < n; i++) {
                        for (let j = 0; j < n; j++) {
                            const k = (i + j) % n;
                            u[k] = (u[k] + currentPublicKey.a[i] * r[j]) % q;
                            v[k] = (v[k] + currentPublicKey.b[i] * r[j]) % q;
                        }
                        u[i] = (u[i] + e1[i]) % q;
                        v[i] = (v[i] + e2[i] + messagePoly[i]) % q;
                    }

                    // –°–æ–∑–¥–∞–Ω–∏–µ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞
                    currentCiphertext = {
                        u: u,
                        v: v,
                        params: currentPublicKey.params,
                        timestamp: new Date().toISOString(),
                        mode: document.getElementById('encryptionMode').value
                    };

                    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    displayCiphertext(currentCiphertext);
                    updateStatus('–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ', 'ready');

                } catch (error) {
                    updateStatus('–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'error');
                }
            }, 100);
        }

        function decryptMessage() {
            const ciphertextText = document.getElementById('encryptedMessage').value;
            const secretKeyText = document.getElementById('decryptionKey').value;

            if (!ciphertextText || !secretKeyText) {
                updateStatus('–í–≤–µ–¥–∏—Ç–µ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á', 'error');
                return;
            }

            updateStatus('–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è...', 'working');
            simulateProgress('decryptProgress', 1500);

            setTimeout(() => {
                try {
                    // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
                    let ciphertext, secretKeyData;
                    
                    try {
                        ciphertext = decodeFromFormat(ciphertextText, detectFormat(ciphertextText));
                        secretKeyData = decodeFromFormat(secretKeyText, detectFormat(secretKeyText));
                    } catch (e) {
                        // –ü–æ–ø—Ä–æ–±—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                        ciphertext = autoDetectAndParseFormat(ciphertextText);
                        secretKeyData = autoDetectAndParseFormat(secretKeyText);
                    }

                    const secretKey = secretKeyData.s;
                    const { n, q } = ciphertext.params;

                    // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ: message = v - u*s
                    const decrypted = new Array(n).fill(0);
                    
                    for (let i = 0; i < n; i++) {
                        for (let j = 0; j < n; j++) {
                            const k = (i + j) % n;
                            decrypted[k] = (decrypted[k] + ciphertext.u[i] * secretKey[j]) % q;
                        }
                    }
                    
                    for (let i = 0; i < n; i++) {
                        decrypted[i] = (ciphertext.v[i] - decrypted[i] + q) % q;
                    }

                    // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    currentDecryptedMessage = decodeMessage(decrypted, n, q);

                    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    document.getElementById('decryptedMessageResult').textContent = currentDecryptedMessage;
                    updateStatus('–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ', 'ready');

                } catch (error) {
                    updateStatus('–û—à–∏–±–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'error');
                }
            }, 100);
        }

        // ============ –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ============

        function encodeMessage(message, n, q) {
            const encoder = new TextEncoder();
            const data = encoder.encode(message);
            const scale = Math.floor(q / 256);
            
            const result = new Array(n).fill(0);
            const maxLength = Math.min(data.length, Math.floor(n / 3)); // –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 3:1
            
            for (let i = 0; i < maxLength; i++) {
                result[i] = (data[i] * scale) % q;
            }
            
            return result;
        }

        function decodeMessage(coefficients, n, q) {
            const scale = Math.floor(q / 256);
            const data = [];
            
            for (let i = 0; i < n; i++) {
                const value = Math.round(coefficients[i] / scale);
                if (value >= 0 && value <= 255) {
                    data.push(value);
                }
                if (value === 0 && i > 0) break;
            }
            
            const decoder = new TextDecoder();
            return decoder.decode(new Uint8Array(data));
        }

        // ============ –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –§–û–†–ú–ê–¢–ê–ú–ò ============

        function arrayBufferToHex(buffer) {
            return Array.from(new Uint8Array(buffer))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        function hexToArrayBuffer(hex) {
            const bytes = new Uint8Array(hex.length / 2);
            for (let i = 0; i < hex.length; i += 2) {
                bytes[i/2] = parseInt(hex.substr(i, 2), 16);
            }
            return bytes;
        }

        function encodeToFormat(data, format) {
            const jsonData = JSON.stringify(data);
            
            switch (format) {
                case 'json':
                    return JSON.stringify(data, null, 2);
                case 'json-compact':
                    return jsonData;
                case 'base64':
                    return btoa(unescape(encodeURIComponent(jsonData)));
                case 'hex':
                    return arrayBufferToHex(new TextEncoder().encode(jsonData));
                default:
                    return jsonData;
            }
        }

        function decodeFromFormat(data, format) {
            try {
                switch (format) {
                    case 'json':
                    case 'json-compact':
                        return JSON.parse(data);
                    case 'base64':
                        return JSON.parse(decodeURIComponent(escape(atob(data))));
                    case 'hex':
                        const bytes = hexToArrayBuffer(data);
                        return JSON.parse(new TextDecoder().decode(bytes));
                    default:
                        return autoDetectAndParseFormat(data);
                }
            } catch (e) {
                throw new Error(`–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ ${format}: ${e.message}`);
            }
        }

        function detectFormat(data) {
            if (!data) return 'json';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ JSON
            try {
                JSON.parse(data);
                return data.includes('\n') ? 'json' : 'json-compact';
            } catch (e) {}
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ base64
            if (/^[A-Za-z0-9+/=]+$/.test(data) && data.length % 4 === 0) {
                try {
                    atob(data);
                    return 'base64';
                } catch (e) {}
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ hex
            if (/^[0-9A-Fa-f]+$/.test(data)) {
                return 'hex';
            }
            
            return 'json'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }

        function autoDetectAndParseFormat(data) {
            try {
                return JSON.parse(data);
            } catch (e) {
                try {
                    return decodeFromFormat(data, 'base64');
                } catch (e2) {
                    try {
                        return decodeFromFormat(data, 'hex');
                    } catch (e3) {
                        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö');
                    }
                }
            }
        }

        function insertLineBreaks(text, chunkSize) {
            if (chunkSize === 'none') return text;
            const size = parseInt(chunkSize);
            const regex = new RegExp(`.{1,${size}}`, 'g');
            const matches = text.match(regex);
            return matches ? matches.join('\n') : text;
        }

        // ============ –§–£–ù–ö–¶–ò–ò –ò–ù–¢–ï–†–§–ï–ô–°–ê ============

        function displayKeys() {
            const keyFormat = RLWE_CONFIG.formats.key;
            const includeMetadata = RLWE_CONFIG.formats.includeMetadata;
            const lineBreaks = RLWE_CONFIG.formats.lineBreaks;
            
            const publicKeyData = {
                a: currentPublicKey.a,
                b: currentPublicKey.b,
                params: currentPublicKey.params
            };
            
            const secretKeyData = {
                s: currentSecretKey,
                params: currentParams
            };
            
            if (includeMetadata) {
                publicKeyData.metadata = {
                    timestamp: currentPublicKey.timestamp,
                    comment: currentPublicKey.comment,
                    algorithm: 'RLWE',
                    securityLevel: RLWE_CONFIG.security.level
                };
            }
            
            let publicKeyText = encodeToFormat(publicKeyData, keyFormat);
            let secretKeyText = encodeToFormat(secretKeyData, keyFormat);
            
            if (lineBreaks !== 'none') {
                publicKeyText = insertLineBreaks(publicKeyText, lineBreaks);
                secretKeyText = insertLineBreaks(secretKeyText, lineBreaks);
            }
            
            document.getElementById('publicKeyDisplay').textContent = publicKeyText;
            document.getElementById('secretKeyDisplay').textContent = secretKeyText;
        }

        function displayCiphertext(ciphertext) {
            const messageFormat = RLWE_CONFIG.formats.message;
            const lineBreaks = RLWE_CONFIG.formats.lineBreaks;
            
            let ciphertextText = encodeToFormat(ciphertext, messageFormat);
            
            if (lineBreaks !== 'none') {
                ciphertextText = insertLineBreaks(ciphertextText, lineBreaks);
            }
            
            document.getElementById('encryptedMessageResult').textContent = ciphertextText;
        }

        function simulateProgress(progressId, duration) {
            let width = 0;
            const interval = 30;
            const steps = duration / interval;
            const increment = 100 / steps;
            
            const progressInterval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(progressInterval);
                } else {
                    width += increment;
                    document.getElementById(progressId).style.width = Math.min(width, 100) + '%';
                }
            }, interval);
        }

        function updateStatus(message, type = 'ready') {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            indicator.className = 'status-indicator';
            if (type === 'working') indicator.classList.add('status-working');
            if (type === 'error') indicator.classList.add('status-error');
            
            statusText.textContent = message;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            const tabs = ['params', 'keys', 'encrypt', 'decrypt', 'formats'];
            const tabIndex = tabs.indexOf(tabName);
            
            if (tabIndex >= 0) {
                document.querySelector(`.tab:nth-child(${tabIndex + 1})`).classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
            }
        }

        function saveParameters() {
            RLWE_CONFIG.security.level = document.getElementById('securityLevel').value;
            RLWE_CONFIG.security.modulusType = document.getElementById('modulusType').value;
            RLWE_CONFIG.security.errorDistribution = document.getElementById('errorDistribution').value;
            RLWE_CONFIG.security.encodingScheme = document.getElementById('encodingScheme').value;
            
            initializeRLWE();
            updateStatus('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã', 'ready');
        }

        function applyFormatSettings() {
            RLWE_CONFIG.formats.key = document.getElementById('keyFormat').value;
            RLWE_CONFIG.formats.message = document.getElementById('messageFormat').value;
            RLWE_CONFIG.formats.lineBreaks = document.getElementById('lineBreaks').value;
            RLWE_CONFIG.formats.includeMetadata = document.getElementById('includeMetadata').checked;
            
            if (currentPublicKey) {
                displayKeys();
            }
            
            updateStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã', 'ready');
        }

        function copyPublicKey() {
            copyToClipboard('publicKeyDisplay', '–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
        }

        function copySecretKey() {
            copyToClipboard('secretKeyDisplay', '–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
        }

        function copyEncryptedMessage() {
            copyToClipboard('encryptedMessageResult', '–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ');
        }

        function copyDecryptedMessage() {
            copyToClipboard('decryptedMessageResult', '–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ');
        }

        function copyToClipboard(elementId, successMessage) {
            const text = document.getElementById(elementId).textContent;
            if (text && !text.includes('–Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω')) {
                navigator.clipboard.writeText(text).then(() => {
                    updateStatus(successMessage, 'ready');
                }).catch(err => {
                    updateStatus('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err, 'error');
                });
            }
        }

        function downloadPublicKey() {
            downloadContent('publicKeyDisplay', 'rlwe_public_key.json');
        }

        function downloadSecretKey() {
            downloadContent('secretKeyDisplay', 'rlwe_secret_key.json');
        }

        function downloadEncryptedMessage() {
            downloadContent('encryptedMessageResult', 'encrypted_message.txt');
        }

        function downloadDecryptedMessage() {
            downloadContent('decryptedMessageResult', 'decrypted_message.txt');
        }

        function downloadContent(elementId, filename) {
            const text = document.getElementById(elementId).textContent;
            if (text && !text.includes('–Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω')) {
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                updateStatus('–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω', 'ready');
            }
        }

        function showPublicKeyInfo() {
            if (!currentPublicKey) return;
            showModal('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—É–±–ª–∏—á–Ω–æ–º –∫–ª—é—á–µ', `
–†–∞–∑–º–µ—Ä: ${JSON.stringify(currentPublicKey).length} –±–∞–π—Ç
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: n=${currentParams.n}, q=${currentParams.q}
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: ${RLWE_CONFIG.security.level} –±–∏—Ç
–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${currentPublicKey.timestamp}
–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${currentPublicKey.comment || '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
            `);
        }

        function showSecretKeyInfo() {
            if (!currentSecretKey) return;
            showModal('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º –∫–ª—é—á–µ', `
–†–∞–∑–º–µ—Ä: ${JSON.stringify({s: currentSecretKey}).length} –±–∞–π—Ç
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: n=${currentParams.n}, q=${currentParams.q}
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: ${RLWE_CONFIG.security.level} –±–∏—Ç
–¢–∏–ø: –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
            `);
        }

        function analyzeCiphertext() {
            if (!currentCiphertext) {
                const ciphertextText = document.getElementById('encryptedMessageResult').textContent;
                if (!ciphertextText) return;
                
                try {
                    currentCiphertext = autoDetectAndParseFormat(ciphertextText);
                } catch (e) {
                    updateStatus('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞', 'error');
                    return;
                }
            }
            
            const size = JSON.stringify(currentCiphertext).length;
            const textSize = document.getElementById('messageToEncrypt').value.length;
            const ratio = (size / textSize).toFixed(1);
            
            showModal('–ê–Ω–∞–ª–∏–∑ —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞', `
–†–∞–∑–º–µ—Ä —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç–∞: ${size} –±–∞–π—Ç
–†–∞–∑–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞: ${textSize} –±–∞–π—Ç
–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: ${ratio}:1
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: n=${currentCiphertext.params.n}, q=${currentCiphertext.params.q}
–†–µ–∂–∏–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ${currentCiphertext.mode || 'standard'}
–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è: ${currentCiphertext.timestamp}
            `);
        }

        function verifyDecryption() {
            const decrypted = document.getElementById('decryptedMessageResult').textContent;
            const original = document.getElementById('messageToEncrypt').value;
            
            if (decrypted && original && decrypted === original) {
                showModal('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', '‚úÖ –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!\n–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—É.');
            } else if (decrypted) {
                showModal('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è', '‚ö†Ô∏è –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.\n–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—É.');
            }
        }

        function showModal(title, content) {
            document.getElementById('modalContent').innerHTML = `
                <h3>${title}</h3>
                <pre style="background: rgba(13,27,42,0.8); padding: 15px; border-radius: 5px; overflow: auto;">${content}</pre>
            `;
            document.getElementById('infoModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('infoModal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('infoModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
        document.addEventListener('DOMContentLoaded', function() {
            initializeRLWE();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            document.getElementById('securityLevel').value = RLWE_CONFIG.security.level;
            document.getElementById('modulusType').value = RLWE_CONFIG.security.modulusType;
            document.getElementById('errorDistribution').value = RLWE_CONFIG.security.errorDistribution;
            document.getElementById('encodingScheme').value = RLWE_CONFIG.security.encodingScheme;
            document.getElementById('keyFormat').value = RLWE_CONFIG.formats.key;
            document.getElementById('messageFormat').value = RLWE_CONFIG.formats.message;
            document.getElementById('lineBreaks').value = RLWE_CONFIG.formats.lineBreaks;
            document.getElementById('includeMetadata').checked = RLWE_CONFIG.formats.includeMetadata;
        });
    </script>
</body>
    </html>
